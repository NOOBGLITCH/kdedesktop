stages:
  - deploy

deploy_to_windows:
  stage: deploy
  image: mcr.microsoft.com/powershell:latest
  script:
    # Create a secure credential object
    - |
      $secpass = ConvertTo-SecureString $env:WINDOWS_PASS -AsPlainText -Force
      $cred = New-Object System.Management.Automation.PSCredential ($env:WINDOWS_USER, $secpass)
      Invoke-Command -ComputerName $env:WINDOWS_HOST -Credential $cred -ScriptBlock {
        Write-Host "Connected to $env:COMPUTERNAME"
        # Example build steps
        Get-ComputerInfo | Select-Object OSName, OSVersion, CsSystemType
        # Run your build script here
      }
  only:
    - main
