stages:
  - deploy

deploy_to_windows:
  stage: deploy
  image: mcr.microsoft.com/powershell:latest
  script:
    - pwsh -NoLogo -Command "& {
        \$secpass = ConvertTo-SecureString \$env:WINDOWS_PASS -AsPlainText -Force;
        \$cred = New-Object System.Management.Automation.PSCredential (\$env:WINDOWS_USER, \$secpass);
        Invoke-Command -ComputerName \$env:WINDOWS_HOST -Credential \$cred -ScriptBlock {
          Write-Host 'Connected to' \$env:COMPUTERNAME;
          Get-ComputerInfo | Select-Object OSName, OSVersion, CsSystemType
        }
      }"
  only:
    - main
