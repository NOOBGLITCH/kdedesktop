stages:
  - setup
  - run

variables:
  WINEPREFIX: "/root/.wine"
  DISPLAY: ":0"  # headless mode

setup_wine:
  stage: setup
  image: ubuntu:22.04
  before_script:
    - dpkg --add-architecture i386
    - apt-get update -y
    - apt-get install -y --no-install-recommends wine32 wine64 winbind xvfb cabextract unzip
    - wine --version
    # Optional: initialize Wine prefix to avoid first-run prompts
    - xvfb-run wineboot --init
  script:
    - echo "âœ… Wine setup complete"
  artifacts:
    paths:
      - /root/.wine

run_windows_app:
  stage: run
  image: ubuntu:22.04
  before_script:
    - dpkg --add-architecture i386
    - apt-get update -y
    - apt-get install -y --no-install-recommends wine32 wine64 winbind xvfb cabextract unzip
    - xvfb-run wineboot --init
  script:
    - echo "WINDOWS_USER=$WINDOWS_USER"
    - echo "WINDOWS_PASS=$WINDOWS_PASS"
    # Example: Download and run a Windows program
    - wget -O testapp.exe https://example.com/some-windows-tool.exe
    - xvfb-run wine testapp.exe
